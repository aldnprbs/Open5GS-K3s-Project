
Try â€‚HackMD Logoâ€‰HackMD
PANDUAN PROYEK MAHASISWA: Open5GS Deployment dengan K3s

Program Studi: Sarjana Ilmu Komputer
Topik: Implementasi dan Testing 5G Core Network
Tahun Akademik: 2025
Repository: https://github.com/rayhanegar/Open5GS-Testbed
  Daftar Isi

    Pendahuluan
    Tujuan Pembelajaran
    Prasyarat
    Arsitektur Sistem
    Instalasi dan Setup
    Verifikasi Deployment
    Tugas 1: Konektivitas Dasar
    Tugas 2: Analisis Packet dengan Wireshark
    Tugas 3: Sequence Diagram
    Troubleshooting
    Referensi

Pendahuluan

Panduan ini memandu mahasiswa dalam melakukan deployment Open5GS (5G Core Network open-source) menggunakan Kubernetes (K3s) dengan Calico CNI. Anda akan belajar:

    Konsep arsitektur 5G SA (Standalone)
    Deployment microservices menggunakan Kubernetes
    Networking di lingkungan containerized
    Protocol analysis untuk 5G
    Troubleshooting network infrastructure

Apa itu Open5GS?

Open5GS adalah implementasi open-source dari 5G Core Network (5GC) sesuai standar 3GPP. Terdiri dari beberapa Network Function (NF):

    AMF (Access and Mobility Management Function): Manajemen registrasi dan mobilitas UE
    SMF (Session Management Function): Manajemen sesi data (PDU sessions)
    UPF (User Plane Function): Forwarding data traffic ke/dari UE
    NRF (Network Repository Function): Service discovery untuk NF lainnya
    AUSF (Authentication Server Function): Autentikasi UE
    UDM (Unified Data Management): Manajemen data subscriber
    UDR (Unified Data Repository): Database subscriber
    PCF (Policy Control Function): Kontrol kebijakan QoS
    NSSF (Network Slice Selection Function): Seleksi slice jaringan
    SCP (Service Communication Proxy): Routing antar NF

Apa itu K3s?

K3s adalah distribusi Kubernetes yang ringan dan efisien, cocok untuk testing dan edge computing. Dengan K3s, mahasiswa dapat:

    Memahami orchestration container
    Deploy aplikasi distributed
    Practice DevOps workflows

Tujuan Pembelajaran

Setelah menyelesaikan proyek ini, mahasiswa diharapkan dapat:
Pengetahuan (Knowledge)

    âœ… Memahami arsitektur dan komponen 5G SA
    âœ… Menjelaskan peran setiap Network Function
    âœ… Memahami konsep network slicing
    âœ… Mengerti Protocol 5G (NGAP, GTP-U, NAS)

Keterampilan (Skills)

    âœ… Deploy dan manage Open5GS di K3s
    âœ… Konfigurasi network functions
    âœ… Analyze network traffic dengan Wireshark
    âœ… Create sequence diagrams dari packet capture
    âœ… Troubleshoot network issues

Kompetensi (Competencies)

    âœ… Infrastructure as Code (IaC)
    âœ… Network debugging dan analysis
    âœ… Cloud-native deployment
    âœ… Technical documentation

Prasyarat
Hardware Requirements

    Minimum:
        2 CPU cores
        4 GB RAM
        20 GB storage
    Recommended:
        4+ CPU cores
        8+ GB RAM
        50+ GB storage

Software Requirements

# Linux Distribution
- Ubuntu 20.04 LTS atau 22.04 LTS
- Kernel 5.4+

# Packages yang akan di-install:
- K3s (Kubernetes)
- Docker/Containerd
- kubectl
- git
- curl
- Wireshark (untuk packet analysis)

Pengetahuan Prasyarat

    Linux command line basics
    Networking fundamentals (IP, DNS, TCP/UDP)
    Docker concepts (containers, images)
    YAML syntax
    Basic understanding of REST APIs

Akses Sistem

# Pastikan punya sudo access
sudo whoami  # Should output "root"

# Clone repository
git clone https://github.com/rayhanegar/Open5GS-Testbed.git
cd Open5GS-Testbed

Arsitektur Sistem
Diagram Arsitektur Keseluruhan

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      UERANSIM (External)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  N2(NGAP)      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  nr-gnb      â”‚â—„â”€â”€SCTP/38412â”€â”€â–ºâ”‚                          â”‚  â”‚
â”‚  â”‚ (gNodeB)     â”‚                â”‚    K3s Cluster          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚    (Kubernetes)         â”‚  â”‚
â”‚       â”‚ N3 (GTP-U)               â”‚                          â”‚  â”‚
â”‚       â”‚ UDP/2152                 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â–ºâ”‚      UPF         â”‚   â”‚  â”‚
â”‚            uesimtun0             â”‚  â”‚ (10.10.0.7)      â”‚   â”‚  â”‚
â”‚            (10.45.0.0/24)        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚                                  â”‚                          â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
â”‚  â”‚  nr-ue       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â–ºâ”‚  Control Plane NFs  â”‚â”‚  â”‚
â”‚  â”‚ (UE)         â”‚                â”‚  â”‚  AMF, SMF, NRF,     â”‚â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚  â”‚  AUSF, UDM, etc     â”‚â”‚  â”‚
â”‚                                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚
â”‚                                  â”‚                          â”‚  â”‚
â”‚                                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚                                  â”‚  â”‚ MongoDB Service  â”‚   â”‚  â”‚
â”‚                                  â”‚  â”‚ (External)       â”‚   â”‚  â”‚
â”‚                                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚                                  â”‚                          â”‚  â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Komponen K3s yang Di-Deploy
Komponen 	StatefulSet 	IP Statis 	Port 	Fungsi
NRF 	nrf-0 	10.10.0.10 	7777 	Service Discovery
SCP 	scp-0 	10.10.0.200 	7777 	Routing
AMF 	amf-0 	10.10.0.5 	7777, 38412 	UE Registration
SMF 	smf-0 	10.10.0.4 	7777 	Session Management
UPF 	upf-0 	10.10.0.7 	2152 	User Plane
UDM 	udm-0 	10.10.0.12 	7777 	Subscriber Data
UDR 	udr-0 	10.10.0.20 	7777 	Data Repository
AUSF 	ausf-0 	10.10.0.11 	7777 	Authentication
PCF 	pcf-0 	10.10.0.13 	7777 	Policy Control
NSSF 	nssf-0 	10.10.0.14 	7777 	Slice Selection
Network Slice Configuration
Slice 	SST 	DNN 	Subnet 	Gateway
eMBB 	1 	embb.testbed 	10.45.0.0/24 	10.45.0.1
URLLC 	2 	urllc.v2x 	10.45.1.0/24 	10.45.1.1
mMTC 	3 	mmtc.testbed 	10.45.2.0/24 	10.45.2.1
Instalasi dan Setup
Step 1: Persiapan Sistem

# Update system
sudo apt-get update
sudo apt-get upgrade -y

# Install dependencies
sudo apt-get install -y \
    curl \
    git \
    iptables \
    iptables-persistent \
    net-tools \
    iputils-ping \
    traceroute \
    tcpdump \
    wireshark \
    wireshark-common

# Create log directories
sudo mkdir -p /mnt/data/open5gs-logs
sudo chmod 777 /mnt/data/open5gs-logs

Step 2: Setup K3s Environment dengan Calico

Navigate ke direktori K3s dan jalankan setup script:

cd ~/Open5GS-Testbed/open5gs/open5gs-k3s-calico

# Make script executable
chmod +x setup-k3s-environment-calico.sh

# Run setup
sudo ./setup-k3s-environment-calico.sh

Script akan melakukan:

    âœ… Install K3s (lightweight Kubernetes)
    âœ… Setup Calico CNI untuk networking
    âœ… Configure static IP pool (10.10.0.0/24)
    âœ… Setup persistent storage
    âœ… Enable SCTP kernel module
    âœ… Configure IP forwarding

Verifikasi K3s Installation:

# Check K3s status
sudo systemctl status k3s

# Check nodes
kubectl get nodes

# Expected output:
# NAME        STATUS   ROLES           AGE   VERSION
# <hostname>  Ready    control-plane   Xm    v1.2X.X

Step 3: Build dan Import Container Images

# Make script executable
chmod +x build-import-containers.sh

# Build Open5GS images
sudo ./build-import-containers.sh

# Verifikasi image
sudo k3s crictl images

Step 4: Deploy Open5GS ke K3s

# Make script executable
chmod +x deploy-k3s-calico.sh

# Deploy
sudo ./deploy-k3s-calico.sh

# Monitor deployment (di terminal baru)
kubectl get pods -n open5gs -w

Deployment akan:

    âœ… Create namespace open5gs
    âœ… Setup Calico IPPool
    âœ… Create MongoDB service
    âœ… Deploy NF dalam order yang benar (dependency management)
    âœ… Generate deployment report

Tunggu hingga semua pod running (~2-3 menit):

# Check all pods
kubectl get pods -n open5gs

# Expected output (all should be Running):
# NAME                  READY   STATUS    RESTARTS   AGE
# nrf-0                 1/1     Running   0          2m
# scp-0                 1/1     Running   0          2m
# udr-0                 1/1     Running   0          2m
# udm-0                 1/1     Running   0          2m
# ausf-0                1/1     Running   0          2m
# pcf-0                 1/1     Running   0          2m
# nssf-0                1/1     Running   0          2m
# amf-0                 1/1     Running   0          2m
# smf-0                 1/1     Running   0          2m
# upf-0                 1/1     Running   0          2m

Verifikasi Deployment
1. Cek Status Semua NF

# List semua pods dengan detail
kubectl get pods -n open5gs -o wide

# Check logs untuk NF tertentu
kubectl logs -n open5gs amf-0
kubectl logs -n open5gs smf-0
kubectl logs -n open5gs upf-0

2. Verifikasi Static IP Assignment

# Run verification script
sudo ./verify-static-ips.sh

# Expected output:
# âœ“ nrf-0: 10.10.0.10
# âœ“ scp-0: 10.10.0.200
# âœ“ amf-0: 10.10.0.5
# âœ“ smf-0: 10.10.0.4
# âœ“ upf-0: 10.10.0.7
# ... (semua NF)

3. Verifikasi MongoDB Connectivity

# Run MongoDB verification
sudo ./verify-mongodb.sh

# Expected output:
# MongoDB: CONNECTED
# Database: open5gs
# Collection count: X subscribers

4. Cek Service Connectivity

# Test NF connectivity from K3s pod
kubectl exec -it -n open5gs nrf-0 -- \
    /bin/sh -c "curl -s http://amf-0.amf.open5gs.svc.cluster.local:7777/nnrf-nfm/v1/nf-instances"

# Atau gunakan pod shell
kubectl exec -it -n open5gs amf-0 -- /bin/bash

# Di dalam pod:
$ curl -s http://nrf-0.nrf.open5gs.svc.cluster.local:7777/nnrf-nfm/v1/nf-instances

Tugas 1: Konektivitas Dasar
Objective

Verify bahwa Open5GS deployment berfungsi dengan benar dan dapat connect dengan UERANSIM.
Prerequisites

    K3s deployment selesai
    Semua pods running
    UERANSIM binary tersedia

Langkah-Langkah
1.1 Persiapkan UERANSIM pada host eksternal

# Di mesin yang berbeda dari K3s (atau terminal baru dengan user biasa):
cd ~/Open5GS-Testbed/ueransim

# Modifikasi gNB config untuk connect ke K3s AMF
# Ubah AMF address di open5gs-gnb-k3s.yaml:
#
# amfConfigs:
#   - address: <K3s_HOST_IP>  # IP address dari K3s cluster
#     port: 38412

1.2 Start gNB Simulator

# Terminal 1 - gNB
cd ~/Open5GS-Testbed/ueransim
./build/nr-gnb -c configs/open5gs-gnb-k3s.yaml

# Expected output:
# [sctp] [info] Trying to establish SCTP connection... (10.X.X.X:38412)
# [sctp] [info] SCTP connection established
# [ngap] [info] NG Setup procedure is successful

1.3 Start UE Simulator

# Terminal 2 - UE
cd ~/Open5GS-Testbed/ueransim
sudo ./build/nr-ue -c configs/open5gs-ue-embb.yaml

# Expected output:
# [nas] [info] UE switches to state [MM-REGISTERED/NORMAL-SERVICE]
# [nas] [info] PDU Session establishment is successful PSI[1]
# [app] [info] Connection setup for PDU session[1] is successful, TUN interface[uesimtun0, 10.45.0.X] is up.

1.4 Test Basic Connectivity

# Terminal 3 - Testing
# Test UE TUN interface
ip addr show uesimtun0

# Test gateway connectivity (UE -> UPF)
ping -I uesimtun0 -c 4 10.45.0.1

# Test internet connectivity
ping -I uesimtun0 -c 4 8.8.8.8

# Test DNS resolution
nslookup google.com 8.8.8.8

# Test HTTP/HTTPS
curl --interface uesimtun0 -I https://www.google.com

1.5 Dokumentasi Hasil

Catat hasil testing dalam format:

## Tugas 1: Konektivitas Dasar

**Tanggal**: [DATE]
**Nama**: [STUDENT NAME]
**Status K3s**: [WORKING/FAILED]

### gNB Registration
- Status: [SUCCESS/FAILED]
- Time taken: [X ms]
- AMF Connection: [ESTABLISHED/FAILED]

### UE Registration
- Status: [SUCCESS/FAILED]
- Time taken: [X ms]
- IMSI: [IMSI from config]
- TUN Interface: [uesimtun0/FAILED]
- IP Address: [10.45.0.X/FAILED]

### Connectivity Tests
| Test | Result | RTT (ms) |
|------|--------|----------|
| UPF Gateway (10.45.0.1) | âœ“ PASS | X.XX |
| Internet (8.8.8.8) | âœ“ PASS | XX.XX |
| DNS Resolution | âœ“ PASS | - |
| HTTP/HTTPS | âœ“ PASS | - |

### Issues Encountered
- [List any issues]

### Resolution
- [How you fixed it]

ğŸ“‹ Laporan dan Submission
Format Laporan

Setiap laporan harus mengikuti format:

# [Judul Tugas]

## I. Tujuan
- Penjelasan singkat apa yang ingin dicapai

## II. Metodologi
- Hardware/software yang digunakan
- Langkah-langkah yang diambil
- Tools yang digunakan

## III. Hasil
- Screenshots (labeled dengan nomor)
- Data/metrics yang dikumpulkan
- Interpretasi hasil

## IV. Analisis
- Penjelasan mendalam tentang hasil
- Hubungan dengan teori 5G
- Insights yang ditemukan

## V. Kesimpulan
- Ringkasan temuan
- Pembelajaran yang didapat
- Saran untuk perbaikan

## VI. Referensi
- Link ke dokumentasi yang digunakan
- Paper atau artikel yang dirujuk

ğŸ”— Referensi dan Resources
Documentation

    Open5GS Official Docs
    UERANSIM GitHub
    3GPP 5G Specifications

Learning Resources

    5G NR Overview
    Kubernetes Documentation
    Wireshark User Guide

Papers

    3GPP TS 23.501: System Architecture for the 5G System
    3GPP TS 38.331: NR Radio Resource Control (RRC)
    3GPP TS 33.501: Security architecture and procedures for 5G

Tools Documentation

    PlantUML Sequence Diagrams
    Draw.io
    tcpdump Documentation
    tshark Documentation

âš ï¸ Troubleshooting
gNB tidak bisa connect ke AMF

# Check AMF is running
kubectl logs -n open5gs -f deployment/amf

# Check firewall
sudo ufw status
sudo ufw allow 38412/sctp

# Verify gNB config
cat ueransim/configs/open5gs-gnb-k3s.yaml | grep -A 3 amfConfigs

UE Authentication Failed

# Verify subscriber in MongoDB
mongosh open5gs --eval "db.subscribers.find()"

# Check security keys match
# Key dan OPC harus sama antara config UE dan MongoDB

# Check UDM logs
kubectl logs -n open5gs -f deployment/udm

TUN Interface tidak muncul

# Check UE output di terminal
# Look for errors tentang PDU Session

# Run as sudo
sudo ./build/nr-ue -c configs/open5gs-ue-embb.yaml

# Set capabilities
sudo setcap cap_net_admin=eip ./build/nr-ue

No Internet Access

# Check UPF is running
kubectl get pods -n open5gs | grep upf

# Check GTP-U tunnel
sudo tcpdump -i any udp port 2152

# Check NAT rules
sudo iptables -t nat -L POSTROUTING -v | grep 10.45.0.0

# Check IP forwarding
sudo sysctl net.ipv4.ip_forward
# Should return: net.ipv4.ip_forward = 1

ğŸ“ Support dan Questions

Jika ada pertanyaan atau masalah:

    Check logs terlebih dahulu: kubectl logs -n open5gs -f [pod-name]
    Search documentation di Open5GS Docs
    Check GitHub Issues: Open5GS Issues
    Ask in class/lab session

ğŸ“„ Lisensi dan Atribusi

    Open5GS: Licensed under AGPL v3
    UERANSIM: Licensed under GPL v3
    Panduan ini: For educational purposes

Selamat belajar dan semoga sukses dengan proyek kalian! ğŸš€
Last changed by 
â€‰
Widhi YahyaÂ·
0
943
Published on HackMD
